name: Generate AsyncAPI Markdown

on:
  push:
    branches: [main, dev]  # or your branch

jobs:
  generate-docs:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Install AsyncAPI Generator
        run: npm install -g @asyncapi/generator

      - name: Generate Markdown
        run: asyncapi generate fromTemplate asyncapi.yaml @asyncapi/markdown-template    

      - name: Overwrite README.md
        run: cat docs/asyncapi.md > README.md

      - name: Commit changes
        run: |
          git config --global user.name 'Yoonhojoon'
          git config --global user.email 'dbsghwns1209@gmail.com'
          git add README.md
          git commit -m "update: asyncapi doc autogenerated"
          git remote set-url origin https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}
          git push origin HEAD:${{ github.ref }}
